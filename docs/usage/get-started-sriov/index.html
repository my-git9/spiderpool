
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>SRIOV Quick Start - spiderpool</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sriov-quick-start" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="spiderpool" class="md-header__button md-logo" aria-label="spiderpool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            spiderpool
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SRIOV Quick Start
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/spidernet-io/spiderpool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderpool
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="spiderpool" class="md-nav__button md-logo" aria-label="spiderpool" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    spiderpool
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/spidernet-io/spiderpool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    spidernet-io/spiderpool
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Spiderpool
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Usage" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-macvlan/" class="md-nav__link">
        Macvlan Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          SRIOV Quick Start
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        SRIOV Quick Start
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-veth" class="md-nav__link">
    Install Veth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-sriov-configmap-that-matches-the-nic-configuration" class="md-nav__link">
    Create Sriov Configmap that matches the NIC configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-sriov-vfs" class="md-nav__link">
    Create Sriov VFs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-sriov-device-plugin" class="md-nav__link">
    Install Sriov Device Plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-sriov-cni" class="md-nav__link">
    Install Sriov CNI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-multus" class="md-nav__link">
    Install Multus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-spiderpool" class="md-nav__link">
    Install Spiderpool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-applications" class="md-nav__link">
    Create applications
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-calico/" class="md-nav__link">
        Calico Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get-started-weave/" class="md-nav__link">
        Weave Quick Start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spider-subnet/" class="md-nav__link">
        SpiderSubnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multiple-subnet.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ippool-multi/" class="md-nav__link">
        Backup IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ippool-namespace/" class="md-nav__link">
        Namespace default IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ippool-affinity-namespace/" class="md-nav__link">
        Namespace affinity of IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ippool-affinity-node/" class="md-nav__link">
        Node affinity of IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ippool-affinity-pod/" class="md-nav__link">
        Pod affinity of IPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ipv6/" class="md-nav__link">
        IPv6 support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../multi-interfaces-annotation/" class="md-nav__link">
        Pod annotation of multi-NIC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../statefulset/" class="md-nav__link">
        StatefulSet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reserved-ip/" class="md-nav__link">
        Reserved IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../third-party-controller/" class="md-nav__link">
        Spiderpool supports third-party controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gc/" class="md-nav__link">
        Reclaim IP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../upgrade/" class="md-nav__link">
        Upgrading Spiderpool Versions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../debug/" class="md-nav__link">
        Q&A
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/arch/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/allocation/" class="md-nav__link">
        IP Allocation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/gc/" class="md-nav__link">
        Resource Reclaim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/annotation/" class="md-nav__link">
        Annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/config/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/metrics/" class="md-nav__link">
        Metric
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/spiderippool/" class="md-nav__link">
        SpiderIPPool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/spiderreservedip/" class="md-nav__link">
        SpiderReservedIP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/spiderendpoint/" class="md-nav__link">
        SpiderEndpoint
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/spidersubnet/" class="md-nav__link">
        SpiderSubnet
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cmdref/spiderpoolctl/" class="md-nav__link">
        spiderpoolctl
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cmdref/spiderpool-controller/" class="md-nav__link">
        spiderpool-controller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cmdref/spiderpool-agent/" class="md-nav__link">
        spiderpool-agent
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/roadmap/" class="md-nav__link">
        roadmap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/contributing/" class="md-nav__link">
        contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/release/" class="md-nav__link">
        workflow for release
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../develop/upgrade.md" class="md-nav__link">
        None
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-veth" class="md-nav__link">
    Install Veth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-sriov-configmap-that-matches-the-nic-configuration" class="md-nav__link">
    Create Sriov Configmap that matches the NIC configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-sriov-vfs" class="md-nav__link">
    Create Sriov VFs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-sriov-device-plugin" class="md-nav__link">
    Install Sriov Device Plugin
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-sriov-cni" class="md-nav__link">
    Install Sriov CNI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-multus" class="md-nav__link">
    Install Multus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-spiderpool" class="md-nav__link">
    Install Spiderpool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-applications" class="md-nav__link">
    Create applications
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  <a href="https://github.com/spidernet-io/spiderpool/edit/master/docs/usage/get-started-sriov.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="sriov-quick-start">SRIOV Quick Start</h1>
<p><strong>English</strong> | <a href="../get-started-sriov-zh_CN/"><strong>简体中文</strong></a></p>
<p>Spiderpool provides a solution for assigning static IP addresses in underlay networks. In this page, we'll demonstrate how to build a complete underlay network solution using <a href="https://github.com/k8snetworkplumbingwg/multus-cni">Multus</a>, <a href="https://github.com/containernetworking/plugins/tree/main/plugins/main/macvlan">Macvlan</a>, <a href="https://github.com/spidernet-io/plugins">Veth</a>, and <a href="https://github.com/spidernet-io/spiderpool">Spiderpool</a>, which meets the following kinds of requirements:</p>
<ul>
<li>
<p>Applications can be assigned static Underlay IP addresses through simple operations.</p>
</li>
<li>
<p>Pods with multiple Underlay NICs connect to multiple Underlay subnets.</p>
</li>
<li>
<p>Pods can communicate in various ways, such as Pod IP, clusterIP, and nodePort.</p>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>Make sure a Kubernetes cluster is ready</li>
<li><a href="https://helm.sh/docs/intro/install/">Helm</a> has already been installed</li>
<li>
<p><a href="https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin#supported-sr-iov-nics">A SR-IOV-enabled NIC</a></p>
</li>
<li>
<p>Check the NIC's bus-info:</p>
</li>
</ol>
<p><code>shell
   ~# ethtool -i enp4s0f0np0 |grep bus-info
   bus-info: 0000:04:00.0</code></p>
<ul>
<li>Check whether the NIC supports SR-IOV via bus-info. If the <code>Single Root I/O Virtualization (SR-IOV)</code> field appears, it means that SR-IOV is supported:</li>
</ul>
<p><code>shell
   ~# lspci -s 0000:04:00.0 -v |grep SR-IOV
   Capabilities: [180] Single Root I/O Virtualization (SR-IOV)</code></p>
<h2 id="install-veth">Install Veth</h2>
<p><a href="https://github.com/spidernet-io/plugins"><code>Veth</code></a> is a CNI plugin designed to resolve the following issues in other CNIs like Macvlan and SR-IOV:</p>
<ul>
<li>
<p>Enable clusterIP communication for Pods in the Sriov CNI scenario</p>
</li>
<li>
<p>Address communication issues in multiple NICs for Pods by automatically coordinating policy routing between NICs</p>
</li>
</ul>
<p>Download and install the Veth binary on all nodes:</p>
<pre><code class="language-shell">~# wget https://github.com/spidernet-io/plugins/releases/download/v0.1.4/spider-plugins-linux-amd64-v0.1.4.tar

~# tar xvfzp ./spider-plugins-linux-amd64-v0.1.4.tar -C /opt/cni/bin

~# chmod +x /opt/cni/bin/veth
</code></pre>
<h2 id="create-sriov-configmap-that-matches-the-nic-configuration">Create Sriov Configmap that matches the NIC configuration</h2>
<ul>
<li>
<p>Check the vendor, deviceID and driver information of the NIC:</p>
<p><code>shell
~# ethtool -i enp4s0f0np0 |grep -e driver -e bus-info
driver: mlx5_core
bus-info: 0000:04:00.0
~#
~# lspci -s 0000:04:00.0 -n
04:00.0 0200: 15b3:1018</code></p>
<blockquote>
<p>In this example, the vendor is 15b3, the deviceID is 1018, and the driver is mlx5_core.</p>
</blockquote>
</li>
<li>
<p>Create Configmap</p>
<p><code>shell
vendor="15b3"
deviceID="1018"
driver="mlx5_core"
cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
    name: sriovdp-config
    namespace: kube-system
data:
    config.json: |
    {
        "resourceList": [{
                "resourceName": "mlnx_sriov",
                "selectors": {
                    "vendors": [ "$vendor" ],
                    "devices": [ "$deviceID" ],
                    "drivers": [ "$driver" ]
                    }
            }
        ]
    }
EOF</code></p>
<blockquote>
<p>resourceName is the name of the Sriov resource, and after it is declared in Configmap, a Sriov resource named <code>intel.com/mlnx_sriov</code> will be generated on the node for Pods after the sriov-plugin takes effect. The prefix <code>intel.com</code> can be defined through the <code>resourcePrefix</code> field.
Refer to <a href="https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin#configurations">Sriov Configmap</a> for more configuration rules.</p>
</blockquote>
</li>
</ul>
<h2 id="create-sriov-vfs">Create Sriov VFs</h2>
<ol>
<li>
<p>Check the current number of VFs:</p>
<p><code>shell
~# cat /sys/class/net/enp4s0f0np0/device/sriov_numvfs
0</code></p>
</li>
<li>
<p>Create 8 VFs</p>
<p><code>shell
~# echo 8 &gt; /sys/class/net/enp4s0f0np0/device/sriov_numvfs</code></p>
<blockquote>
<p>Refer to <a href="https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin/blob/master/docs/vf-setup.md">Setting up Virtual Functions</a> for more details.</p>
</blockquote>
</li>
</ol>
<h2 id="install-sriov-device-plugin">Install Sriov Device Plugin</h2>
<pre><code class="language-shell">~# kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/sriov-network-device-plugin/v3.5.1/deployments/k8s-v1.16/sriovdp-daemonset.yaml
</code></pre>
<p>Wait for the plugin to take effect After installation.</p>
<ul>
<li>
<p>Check the Node and verify that the Sriov resource named <code>intel.com/mlnx_sriov</code> defined in Configmap has taken effect, with 8 as the number of VFs:</p>
<p><code>shell
~# kubectl get  node  master-11 -ojson |jq '.status.allocatable'
{
  "cpu": "24",
  "ephemeral-storage": "94580335255",
  "hugepages-1Gi": "0",
  "hugepages-2Mi": "0",
  "intel.com/mlnx_sriov": "8",
  "memory": "16247944Ki",
  "pods": "110"
}</code></p>
</li>
</ul>
<h2 id="install-sriov-cni">Install Sriov CNI</h2>
<ol>
<li>
<p>Install Sriov CNI through manifest:</p>
<p><code>shell
~# kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/sriov-cni/v2.7.0/images/k8s-v1.16/sriov-cni-daemonset.yaml</code></p>
</li>
</ol>
<h2 id="install-multus">Install Multus</h2>
<ol>
<li>
<p>Install Multus through manifest:</p>
<p><code>shell
~# kubectl apply -f https://raw.githubusercontent.com/k8snetworkplumbingwg/multus-cni/v3.9/deployments/multus-daemonset.yml</code></p>
</li>
<li>
<p>Create a NetworkAttachmentDefinition configuration for Sriov in Multus</p>
</li>
</ol>
<p>To implement clusterIP communication using Veth, confirm the service CIDR of the cluster through a query command <code>kubectl -n kube-system get configmap kubeadm-config -oyaml | grep service</code> or other methods:</p>
<pre><code>```shell
SERVICE_CIDR="10.43.0.0/16"
cat &lt;&lt;EOF | kubectl apply -f -
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  annotations:
    k8s.v1.cni.cncf.io/resourceName: intel.com/mlnx_sriov
  name: sriov-test
  namespace: kube-system
spec:
  config: |-
    {
        "cniVersion": "0.3.1",
        "name": "sriov-test",
        "plugins": [
            {
                "type": "sriov",
                "ipam": {
                    "type": "spiderpool"
                }
            },{
                  "type": "veth",
                  "service_cidr": ["${SERVICE_CIDR}"]
              }
        ]
    }
</code></pre>
<p>EOF
    ```</p>
<blockquote>
<p><code>k8s.v1.cni.cncf.io/resourceName: intel.com/mlnx_sriov</code>: the name of the Sriov resource to be used</p>
</blockquote>
<h2 id="install-spiderpool">Install Spiderpool</h2>
<ol>
<li>
<p>Install Spiderpool CRD</p>
<p><code>shell
helm repo add spiderpool https://spidernet-io.github.io/spiderpool
helm repo update spiderpool
helm install spiderpool spiderpool/spiderpool --namespace kube-system \
    --set feature.enableIPv4=true --set feature.enableIPv6=false</code></p>
</li>
<li>
<p>Create a SpiderSubnet instance.</p>
</li>
</ol>
<p>The Pod will obtain an IP address from this subnet for underlying network communication, so the subnet needs to correspond to the underlying subnet that is being accessed.
   Here is an example of creating a SpiderSubnet instance:：</p>
<p><code>shell
   cat &lt;&lt;EOF | kubectl apply -f -
   apiVersion: spiderpool.spidernet.io/v2beta1
   kind: SpiderSubnet
   metadata:
     name: subnet-test
   spec:
     ipVersion: 4
     ips:
     - "10.20.168.190-10.20.168.199"
     subnet: 10.20.0.0/16
     gateway: 10.20.0.1
     vlan: 0
   EOF</code></p>
<h2 id="create-applications">Create applications</h2>
<ol>
<li>Create test Pods and Services via the command below：</li>
</ol>
<p>```shell
   cat &lt;&lt;EOF | kubectl create -f -
   apiVersion: apps/v1
   kind: Deployment
   metadata:
     name: sriov-deploy
   spec:
     replicas: 2
     selector:
       matchLabels:
         app: sriov-deploy
     template:
       metadata:
         annotations:
           ipam.spidernet.io/subnet: |-
             {
               "ipv4": ["subnet-test"]
             }
           v1.multus-cni.io/default-network: kube-system/sriov-test
         labels:
           app: sriov-deploy
       spec:
         containers:
         - name: sriov-deploy
           image: nginx
           imagePullPolicy: IfNotPresent
           ports:
           - name: http
             containerPort: 80
             protocol: TCP
           resources:
             requests:
               intel.com/mlnx_sriov: '1' 
             limits:
               intel.com/mlnx_sriov: '1'  </p>
<hr />
<p>apiVersion: v1
   kind: Service
   metadata:
     name: sriov-deploy-svc
     labels:
       app: sriov-deploy
   spec:
     type: ClusterIP
     ports:
       - port: 80
         protocol: TCP
         targetPort: 80
     selector:
       app: sriov-deploy 
   EOF
   ```</p>
<p>Spec descriptions:</p>
<blockquote>
<p><code>intel.com/mlnx_sriov</code>: Sriov resources used.</p>
<p><code>v1.multus-cni.io/default-network</code>: specifies the CNI configuration for Multus.</p>
<p>For more information on Multus annotations, refer to <a href="https://github.com/k8snetworkplumbingwg/multus-cni/blob/master/docs/quickstart.md">Multus Quickstart</a>.</p>
</blockquote>
<ol>
<li>Check the status of Pods:</li>
</ol>
<p><code>shell
   ~# kubectl get pod -l app=sriov-deploy -owide
   NAME                           READY   STATUS    RESTARTS   AGE     IP              NODE        NOMINATED NODE   READINESS GATES
   sriov-deploy-9b4b9f6d9-mmpsm   1/1     Running   0          6m54s   10.20.168.191   worker-12   &lt;none&gt;           &lt;none&gt;
   sriov-deploy-9b4b9f6d9-xfsvj   1/1     Running   0          6m54s   10.20.168.190   master-11   &lt;none&gt;           &lt;none&gt;</code></p>
<ol>
<li>Spiderpool has created fixed IP pools for applications, ensuring that the applications' IPs are automatically fixed within the defined ranges.</li>
</ol>
<p>```shell
   ~# kubectl get spiderippool
   NAME                                     VERSION   SUBNET         ALLOCATED-IP-COUNT   TOTAL-IP-COUNT   DEFAULT   DISABLE
   auto-sriov-deploy-v4-eth0-f5488b112fd9   4         10.20.0.0/16   2                    2                false     false</p>
<p>~#  kubectl get spiderendpoints
   NAME                           INTERFACE   IPV4POOL                                 IPV4               IPV6POOL   IPV6   NODE
   sriov-deploy-9b4b9f6d9-mmpsm   eth0        auto-sriov-deploy-v4-eth0-f5488b112fd9   10.20.168.191/16                     worker-12
   sriov-deploy-9b4b9f6d9-xfsvj   eth0        auto-sriov-deploy-v4-eth0-f5488b112fd9   10.20.168.190/16                     master-11
   ```</p>
<ol>
<li>Test the communication between Pods:</li>
</ol>
<p>```shell
   ~# kubectl exec -it sriov-deploy-9b4b9f6d9-mmpsm -- ping 10.20.168.190 -c 3
   PING 10.20.168.190 (10.20.168.190) 56(84) bytes of data.
   64 bytes from 10.20.168.190: icmp_seq=1 ttl=64 time=0.162 ms
   64 bytes from 10.20.168.190: icmp_seq=2 ttl=64 time=0.138 ms
   64 bytes from 10.20.168.190: icmp_seq=3 ttl=64 time=0.191 ms</p>
<p>--- 10.20.168.190 ping statistics ---
   3 packets transmitted, 3 received, 0% packet loss, time 2051ms
   rtt min/avg/max/mdev = 0.138/0.163/0.191/0.021 ms
   ```</p>
<ol>
<li>
<p>Test the communication between Pods and Services:</p>
</li>
<li>
<p>Check Services' IPs：</p>
</li>
</ol>
<p><code>shell
   ~# kubectl get svc
   NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)              AGE
   kubernetes         ClusterIP   10.43.0.1      &lt;none&gt;        443/TCP              23d
   sriov-deploy-svc   ClusterIP   10.43.54.100   &lt;none&gt;        80/TCP               20m</code></p>
<ul>
<li>Access its own service within the Pod:</li>
</ul>
<p><code>shell
   ~# kubectl exec -it sriov-deploy-9b4b9f6d9-mmpsm -- curl 10.43.54.100 -I
   HTTP/1.1 200 OK
   Server: nginx/1.23.3
   Date: Mon, 27 Mar 2023 08:22:39 GMT
   Content-Type: text/html
   Content-Length: 615
   Last-Modified: Tue, 13 Dec 2022 15:53:53 GMT
   Connection: keep-alive
   ETag: "6398a011-267"
   Accept-Ranges: bytes</code></p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../get-started-macvlan/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Macvlan Quick Start" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Macvlan Quick Start
            </div>
          </div>
        </a>
      
      
        
        <a href="../get-started-calico/" class="md-footer__link md-footer__link--next" aria-label="Next: Calico Quick Start" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Calico Quick Start
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.top", "navigation.tracking", "search.highlight", "search.suggest", "search.share"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>